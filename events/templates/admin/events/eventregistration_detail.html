{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Registrations for {{ event.title }}{% endblock %}

{% block content %}
<div id="content-main">
    <div style="margin-bottom: 20px;">
        <a href="{% url 'admin:events_eventregistration_changelist' %}" class="button">‚Üê Back to Events List</a>
        <a href="{% url 'admin:events_event_change' event.id %}" class="button">Edit Event</a>
    </div>
    
    <h1>Registrations for: {{ event.title }}</h1>
    
    <div class="module" style="margin-bottom: 20px; padding: 15px;">
        <h2>Event Details</h2>
        <p><strong>Type:</strong> {{ event.get_event_type_display }}</p>
        <p><strong>Date:</strong> {{ event.start_date|date:"Y-m-d H:i" }} to {{ event.end_date|date:"Y-m-d H:i" }}</p>
        <p><strong>Location:</strong> {{ event.location }}</p>
        <p><strong>Status:</strong> {{ event.get_status_display }}</p>
        <p><strong>Total Registrations:</strong> {{ registrations.count }}
            {% if event.max_participants %}/ {{ event.max_participants }}{% endif %}
        </p>
    </div>
    
    <form method="post" action="">
        {% csrf_token %}
        
        <div class="module" style="margin-bottom: 15px;">
            <label for="action">Bulk Actions:</label>
            <select name="action" id="action">
                <option value="">---------</option>
                <option value="mark_as_attended">Mark as Attended</option>
                <option value="mark_certificates_issued">Mark Certificates Issued</option>
                <option value="verify_payment">Verify Payment</option>
            </select>
            <button type="submit" class="button">Apply</button>
        </div>
        
        <div class="module">
            <table style="width: 100%;">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all"></th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Mobile</th>
                        <th>Institution/Org</th>
                        <th>Payment</th>
                        <th>Amount</th>
                        <th>Attended</th>
                        <th>Certificate</th>
                        <th>Registered</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reg in registrations %}
                    <tr>
                        <td><input type="checkbox" name="_selected_action" value="{{ reg.id }}"></td>
                        <td><strong>{{ reg.name }}</strong></td>
                        <td>{{ reg.email }}</td>
                        <td>{{ reg.mobile_number }}</td>
                        <td>{{ reg.institution|default:reg.organization|default:"-" }}</td>
                        <td>
                            <span style="
                                background: {% if reg.payment_status == 'paid' %}#4caf50{% elif reg.payment_status == 'pending' %}#ff9800{% elif reg.payment_status == 'exempted' %}#2196f3{% else %}#9e9e9e{% endif %};
                                color: white;
                                padding: 3px 8px;
                                border-radius: 3px;
                                font-size: 11px;
                            ">
                                {{ reg.get_payment_status_display }}
                            </span>
                        </td>
                        <td>‚Çπ{{ reg.payment_amount|default:"0" }}</td>
                        <td style="text-align: center;">
                            {% if reg.attended %}
                                <span style="color: green; font-size: 18px;">‚úì</span>
                            {% else %}
                                <span style="color: #ccc;">‚Äî</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if reg.certificate_issued %}
                                <span style="font-size: 18px;">üìú</span>
                            {% else %}
                                <span style="color: #ccc;">‚Äî</span>
                            {% endif %}
                        </td>
                        <td>{{ reg.registered_at|date:"Y-m-d H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 20px;">
                            No registrations yet for this event.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </form>
</div>

<script>
document.getElementById('select-all').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
});
</script>

<style>
    .module table {
        border-collapse: collapse;
    }
    .module table th {
        background: #417690;
        color: white;
        padding: 10px;
        text-align: left;
    }
    .module table td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
    }
    .module table tbody tr:hover {
        background: #f5f5f5;
    }
    .module h2 {
        margin-top: 0;
    }
</style>
{% endblock %}
